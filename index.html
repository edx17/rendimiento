<!DOCTYPE html>
<html lang="es-AR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rendimiento - Libertadores de San Cristóbal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        club: {
                            dark: '#0f172a',
                            panel: '#1e293b',
                            primary: '#3b82f6',
                            accent: '#10b981'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: 'Segoe UI', system-ui, sans-serif; }
        .tab-active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        .metric-card { background: #1e293b; border-radius: 0.75rem; padding: 1.25rem; border: 1px solid #334155; }
        .traffic-red { color: #ef4444; }
        .traffic-yellow { color: #eab308; }
        .traffic-green { color: #22c55e; }
        .bg-traffic-red { background-color: rgba(239, 68, 68, 0.2); border: 1px solid #ef4444; }
        .bg-traffic-yellow { background-color: rgba(234, 179, 8, 0.2); border: 1px solid #eab308; }
        .bg-traffic-green { background-color: rgba(34, 197, 94, 0.2); border: 1px solid #22c55e; }
        canvas { max-height: 350px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navbar -->
    <header class="bg-club-panel border-b border-slate-700 p-4 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center overflow-hidden border-2 border-slate-600 text-xs text-center leading-tight">
                    [Escudo Libertadores]
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight uppercase">Libertadores de San Cristóbal</h1>
                    <p class="text-xs text-slate-400">Departamento de Preparación Física - 1ra AFA</p>
                </div>
            </div>
            <nav class="flex gap-2 bg-slate-800 p-1 rounded-lg">
                <button onclick="switchTab('dashboard')" id="btn-dashboard" class="px-4 py-2 rounded-md text-sm font-medium bg-slate-700 text-white transition-colors">Resumen Equipo</button>
                <button onclick="switchTab('individual')" id="btn-individual" class="px-4 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-colors">Perfil Individual</button>
                <button onclick="switchTab('compare')" id="btn-compare" class="px-4 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-colors">Comparativa</button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-6 max-w-7xl mx-auto w-full">
        
        <!-- View: Dashboard -->
        <div id="view-dashboard" class="space-y-6">
            <h2 class="text-2xl font-bold border-b border-slate-700 pb-2">Estado General del Plantel</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="metric-card">
                    <h3 class="text-sm font-semibold text-slate-400 mb-4">Distribución de Puestos</h3>
                    <canvas id="chart-positions"></canvas>
                </div>
                <div class="metric-card md:col-span-2">
                    <h3 class="text-sm font-semibold text-slate-400 mb-4">Evolución Yo-Yo Test (Promedios 2025 vs 2026)</h3>
                    <canvas id="chart-yoyo-team"></canvas>
                </div>
            </div>
            <div class="metric-card">
                <h3 class="text-sm font-semibold text-slate-400 mb-4">Alertas Críticas del Equipo (Asimetrías > 10% y Adiposidad Alta)</h3>
                <div id="team-alerts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- Dinámico -->
                </div>
            </div>
        </div>

        <!-- View: Individual -->
        <div id="view-individual" class="space-y-6 hidden">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center border-b border-slate-700 pb-4 gap-4">
                <h2 class="text-2xl font-bold">Análisis Individual</h2>
                <select id="player-select" class="bg-slate-800 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 w-full md:w-64" onchange="renderIndividualView()">
                    <!-- Options generadas por JS -->
                </select>
            </div>

            <div id="individual-content" class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Columna Izquierda: Perfil y Antropometría -->
                <div class="space-y-6">
                    <div class="metric-card flex items-center gap-4">
                        <div class="w-20 h-20 bg-slate-700 rounded-full flex items-center justify-center text-2xl font-bold text-slate-400">
                            <span id="player-initials">--</span>
                        </div>
                        <div>
                            <h3 id="player-name" class="text-xl font-bold">Nombre Jugador</h3>
                            <p id="player-position" class="text-sm text-slate-400 uppercase tracking-wide">Puesto | Pierna</p>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h3 class="text-sm font-semibold text-slate-400 mb-4">Composición Corporal (Impedancia)</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4 text-center">
                            <div class="p-3 bg-slate-800 rounded-lg">
                                <div class="text-xs text-slate-400">Peso</div>
                                <div id="ind-peso" class="text-lg font-bold">- kg</div>
                            </div>
                            <div class="p-3 bg-slate-800 rounded-lg">
                                <div class="text-xs text-slate-400">Talla</div>
                                <div id="ind-talla" class="text-lg font-bold">- m</div>
                            </div>
                            <div id="card-adip" class="p-3 rounded-lg bg-traffic-green">
                                <div class="text-xs opacity-80">Adiposidad</div>
                                <div id="ind-adip" class="text-lg font-bold">- %</div>
                            </div>
                            <div id="card-musc" class="p-3 rounded-lg bg-traffic-green">
                                <div class="text-xs opacity-80">Masa Muscular</div>
                                <div id="ind-musc" class="text-lg font-bold">- %</div>
                            </div>
                        </div>
                        <canvas id="chart-radar-ind"></canvas>
                    </div>
                </div>

                <!-- Columna Central: Rendimiento y Potencia -->
                <div class="space-y-6">
                    <div class="metric-card">
                        <h3 class="text-sm font-semibold text-slate-400 mb-4">Capacidad Aeróbica (Yo-Yo Test)</h3>
                        <div class="flex items-end gap-4">
                            <div class="flex-1">
                                <canvas id="chart-yoyo-ind"></canvas>
                            </div>
                            <div id="yoyo-indicator" class="w-16 h-16 rounded-full flex items-center justify-center font-bold text-xl mb-6">
                                -
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h3 class="text-sm font-semibold text-slate-400 mb-4">Potencia y Asimetría (CMJ / Broad Jump)</h3>
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="p-3 bg-slate-800 rounded-lg text-center">
                                <div class="text-xs text-slate-400">CMJ Bipodal</div>
                                <div id="ind-cmj" class="text-xl font-bold">- cm</div>
                            </div>
                            <div id="card-asym" class="p-3 rounded-lg text-center">
                                <div class="text-xs opacity-80">Asimetría CMJ</div>
                                <div id="ind-asym" class="text-xl font-bold">- %</div>
                            </div>
                        </div>
                        <canvas id="chart-power-ind"></canvas>
                    </div>
                </div>

                <!-- Columna Derecha: Kinesiología y Recomendaciones -->
                <div class="space-y-6">
                    <div class="metric-card">
                        <h3 class="text-sm font-semibold text-slate-400 mb-4">Evaluación Kinésica</h3>
                        <ul class="space-y-3 text-sm">
                            <li class="flex flex-col bg-slate-800 p-3 rounded-md border-l-4 border-blue-500">
                                <span class="text-xs text-slate-400 uppercase">Tobillos</span>
                                <span id="kin-tobillos" class="font-medium">-</span>
                            </li>
                            <li class="flex flex-col bg-slate-800 p-3 rounded-md border-l-4 border-indigo-500">
                                <span class="text-xs text-slate-400 uppercase">Cadera (Jurdan)</span>
                                <span id="kin-cadera" class="font-medium">-</span>
                            </li>
                            <li class="flex flex-col bg-slate-800 p-3 rounded-md border-l-4 border-purple-500">
                                <span class="text-xs text-slate-400 uppercase">Estabilidad Unipodal</span>
                                <span id="kin-unipodal" class="font-medium">-</span>
                            </li>
                        </ul>
                    </div>

                    <div class="metric-card border border-red-900 bg-red-900/10">
                        <h3 class="text-sm font-semibold text-red-400 mb-3 uppercase tracking-wide">Alertas & Plan de Acción</h3>
                        <div id="ind-alerts" class="space-y-3 text-sm">
                            <!-- Inyectado por JS -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View: Compare -->
        <div id="view-compare" class="space-y-6 hidden">
            <h2 class="text-2xl font-bold border-b border-slate-700 pb-2">Comparativa de Jugadores</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Jugador A</label>
                    <select id="compare-select-1" class="bg-slate-800 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 block w-full p-2.5" onchange="renderCompareView()"></select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-2">Jugador B</label>
                    <select id="compare-select-2" class="bg-slate-800 border border-slate-600 text-white text-sm rounded-lg focus:ring-blue-500 block w-full p-2.5" onchange="renderCompareView()"></select>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="metric-card">
                    <h3 class="text-sm font-semibold text-slate-400 mb-4">Composición Corporal vs Promedio</h3>
                    <canvas id="chart-compare-radar"></canvas>
                </div>
                <div class="metric-card">
                    <h3 class="text-sm font-semibold text-slate-400 mb-4">Potencia (CMJ & Broad)</h3>
                    <canvas id="chart-compare-bar"></canvas>
                </div>
            </div>
            
            <div class="metric-card overflow-x-auto">
                <table class="w-full text-sm text-left text-slate-300">
                    <thead class="text-xs text-slate-400 uppercase bg-slate-800">
                        <tr>
                            <th scope="col" class="px-6 py-3">Métrica</th>
                            <th scope="col" class="px-6 py-3" id="comp-name-1">Jugador A</th>
                            <th scope="col" class="px-6 py-3" id="comp-name-2">Jugador B</th>
                            <th scope="col" class="px-6 py-3">Diferencia</th>
                        </tr>
                    </thead>
                    <tbody id="compare-table-body">
                        <!-- Inyectado por JS -->
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // Data estructurada desde el CSV proporcionado
        const playersData = [
            {
                id: 1, name: "Alberto, Joaquin", position: "Cierre", leg: "Derecho", 
                weight: 68.3, height: 1.77, 
                impedance: { musc: 45.2, adip: 11.8, visc: 4, imc: 21.8, edMet: 21 },
                yoyo: { y2025: 20.0, y2026: 20.8, dif: 0.8 },
                power: { cmj: 44.1, abK: 59.3, cmj_de: 25.5, cmj_iz: 24.6, asym_cmj: -3.53, broad: 2.58, broad_de: 2.13, broad_iz: 2.2, asym_broad: 3.28 },
                kin: { tobillos: "Movilidad optima", cadera: "Rom optimo c/carga isquio", unipodal: "poca estabilidad", sentadilla: "Buena profundidad y movilidad", recomendaciones: "reducir tension isquiosural, trabajar estabilidad pelvica/cadera" }
            },
            {
                id: 2, name: "Arzani, Ramiro", position: "Arquero", leg: "Izquierda", 
                weight: 78.5, height: 1.83, 
                impedance: { musc: 44.0, adip: 14.5, visc: 6, imc: 23.4, edMet: 25 },
                yoyo: { y2025: 18.3, y2026: 18.1, dif: -0.2 },
                power: { cmj: 45.3, abK: 52.8, cmj_de: 28.2, cmj_iz: 24.6, asym_cmj: -12.77, broad: 2.46, broad_de: 2.35, broad_iz: 2.1, asym_broad: -10.64 },
                kin: { tobillos: "Movilidad reducida ambos tobillos", cadera: "Rom optimo c/carga isquio", unipodal: "buena movilidad y estabilidad", sentadilla: "Levanta Talones", recomendaciones: "" }
            },
            {
                id: 3, name: "Benitez, Marcos", position: "Ala", leg: "Derecho", 
                weight: 71.2, height: 1.75, 
                impedance: { musc: 48.1, adip: 9.8, visc: 3, imc: 23.2, edMet: 20 },
                yoyo: { y2025: 20.5, y2026: 21.1, dif: 0.6 },
                power: { cmj: 44.1, abK: 46.5, cmj_de: 22.0, cmj_iz: 23.8, asym_cmj: 8.18, broad: 2.25, broad_de: 2.04, broad_iz: 2.1, asym_broad: 2.94 },
                kin: { tobillos: "Movilidad reducida ambos tobillos", cadera: "Rom optimo +90", unipodal: "rodilla en varo, poca/nula movilidad pelvis", sentadilla: "Poca movilidad", recomendaciones: "mejorar movilidad tobillo, mejorar movilidad escapular" }
            },
            {
                id: 4, name: "Figueroa, Frank", position: "Pivot", leg: "Derecho", 
                weight: 82.1, height: 1.88, 
                impedance: { musc: 46.5, adip: 13.2, visc: 5, imc: 24.5, edMet: 26 },
                yoyo: { y2025: 19.0, y2026: 18.5, dif: -0.5 },
                power: { cmj: 48.5, abK: 60.1, cmj_de: 28.0, cmj_iz: 23.5, asym_cmj: 16.07, broad: 2.65, broad_de: 2.40, broad_iz: 2.10, asym_broad: 12.5 },
                kin: { tobillos: "Movilidad optima", cadera: "Acortamiento psoas", unipodal: "inestabilidad lateral", sentadilla: "Retroversion pelvica", recomendaciones: "Estiramiento flexores cadera, fuerza gluteo medio" }
            },
            {
                id: 5, name: "Cabrera, Agustín", position: "Ala", leg: "Izquierda", 
                weight: 66.6, height: 1.69, 
                impedance: { musc: 45.8, adip: 10.5, visc: 3, imc: 23.3, edMet: 22 },
                yoyo: { y2025: 21.0, y2026: 21.8, dif: 0.8 },
                power: { cmj: 41.2, abK: 45.0, cmj_de: 21.0, cmj_iz: 20.5, asym_cmj: 2.38, broad: 2.30, broad_de: 2.15, broad_iz: 2.10, asym_broad: 2.32 },
                kin: { tobillos: "Optima", cadera: "Optima", unipodal: "Estable", sentadilla: "Profunda, tecnica correcta", recomendaciones: "" }
            }
        ];

        // Reglas de negocio (Semáforos)
        const rules = {
            adipose: { green: 11, yellow: 13 }, // Menor a 11 verde, 11-13 amarillo, >13 rojo
            muscle: { green: 46, yellow: 44 },  // Mayor a 46 verde, 44-46 amarillo, <44 rojo
            asymmetry: { green: 8, yellow: 12 } // Menor a 8% verde, 8-12% amarillo, >12% rojo
        };

        // Estado Global para Gráficos (evitar overlaps)
        let chartInstances = {};

        function init() {
            populateSelects();
            renderDashboard();
        }

        function switchTab(tabId) {
            document.getElementById('view-dashboard').classList.add('hidden');
            document.getElementById('view-individual').classList.add('hidden');
            document.getElementById('view-compare').classList.add('hidden');
            
            document.getElementById('btn-dashboard').className = 'px-4 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-colors';
            document.getElementById('btn-individual').className = 'px-4 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-colors';
            document.getElementById('btn-compare').className = 'px-4 py-2 rounded-md text-sm font-medium text-slate-400 hover:text-white transition-colors';
            
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).className = 'px-4 py-2 rounded-md text-sm font-medium bg-slate-700 text-white transition-colors';

            if(tabId === 'dashboard') renderDashboard();
            if(tabId === 'individual') renderIndividualView();
            if(tabId === 'compare') renderCompareView();
        }

        function populateSelects() {
            const selects = ['player-select', 'compare-select-1', 'compare-select-2'];
            selects.forEach(id => {
                const el = document.getElementById(id);
                el.innerHTML = '';
                playersData.forEach((p, index) => {
                    const opt = document.createElement('option');
                    opt.value = p.id;
                    opt.text = p.name;
                    if(id === 'compare-select-2' && index === 1) opt.selected = true;
                    el.appendChild(opt);
                });
            });
        }

        function getTrafficColor(val, type, returnClass = false) {
            let color = '';
            let bgClass = '';
            val = Math.abs(val);

            if (type === 'adipose') {
                if (val <= rules.adipose.green) { color = '#22c55e'; bgClass = 'bg-traffic-green'; }
                else if (val <= rules.adipose.yellow) { color = '#eab308'; bgClass = 'bg-traffic-yellow'; }
                else { color = '#ef4444'; bgClass = 'bg-traffic-red'; }
            } else if (type === 'muscle') {
                if (val >= rules.muscle.green) { color = '#22c55e'; bgClass = 'bg-traffic-green'; }
                else if (val >= rules.muscle.yellow) { color = '#eab308'; bgClass = 'bg-traffic-yellow'; }
                else { color = '#ef4444'; bgClass = 'bg-traffic-red'; }
            } else if (type === 'asymmetry') {
                if (val <= rules.asymmetry.green) { color = '#22c55e'; bgClass = 'bg-traffic-green'; }
                else if (val <= rules.asymmetry.yellow) { color = '#eab308'; bgClass = 'bg-traffic-yellow'; }
                else { color = '#ef4444'; bgClass = 'bg-traffic-red'; }
            }

            return returnClass ? bgClass : color;
        }

        function destroyChart(id) {
            if (chartInstances[id]) {
                chartInstances[id].destroy();
            }
        }

        // --- DASHBOARD ---
        function renderDashboard() {
            // Posiciones
            const posCount = {};
            playersData.forEach(p => posCount[p.position] = (posCount[p.position] || 0) + 1);
            
            destroyChart('chart-positions');
            const ctxPos = document.getElementById('chart-positions').getContext('2d');
            chartInstances['chart-positions'] = new Chart(ctxPos, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(posCount),
                    datasets: [{
                        data: Object.values(posCount),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#8b5cf6'],
                        borderColor: '#1e293b',
                        borderWidth: 2
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'bottom', labels: { color: '#cbd5e1' } } } }
            });

            // YoYo Team
            const avgYoyo25 = playersData.reduce((acc, p) => acc + p.yoyo.y2025, 0) / playersData.length;
            const avgYoyo26 = playersData.reduce((acc, p) => acc + p.yoyo.y2026, 0) / playersData.length;

            destroyChart('chart-yoyo-team');
            const ctxYoyo = document.getElementById('chart-yoyo-team').getContext('2d');
            chartInstances['chart-yoyo-team'] = new Chart(ctxYoyo, {
                type: 'bar',
                data: {
                    labels: ['Promedio Plantel'],
                    datasets: [
                        { label: '2025', data: [avgYoyo25], backgroundColor: '#475569' },
                        { label: '2026', data: [avgYoyo26], backgroundColor: '#3b82f6' }
                    ]
                },
                options: { 
                    responsive: true, 
                    scales: { y: { beginAtZero: false, min: 16, ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } },
                    plugins: { legend: { labels: { color: '#cbd5e1' } } }
                }
            });

            // Generar Alertas
            const alertsDiv = document.getElementById('team-alerts');
            alertsDiv.innerHTML = '';
            playersData.forEach(p => {
                if (Math.abs(p.power.asym_cmj) > rules.asymmetry.yellow || p.impedance.adip > rules.adipose.yellow) {
                    alertsDiv.innerHTML += `
                        <div class="bg-slate-800 border-l-4 border-red-500 p-3 rounded shadow">
                            <div class="font-bold text-sm">${p.name}</div>
                            <div class="text-xs text-slate-400 mt-1">
                                ${Math.abs(p.power.asym_cmj) > rules.asymmetry.yellow ? `<span class="text-red-400">Asimetría CMJ: ${p.power.asym_cmj}%</span><br>` : ''}
                                ${p.impedance.adip > rules.adipose.yellow ? `<span class="text-orange-400">Adiposidad: ${p.impedance.adip}%</span>` : ''}
                            </div>
                        </div>
                    `;
                }
            });
        }

        // --- INDIVIDUAL ---
        function generateActionPlan(player) {
            let html = '';
            
            // Fisiología
            if (player.impedance.adip > rules.adipose.yellow) html += `<div class="mb-2"><span class="font-bold text-red-500">⚠ Nutrición:</span> Adiposidad elevada (${player.impedance.adip}%). Intervención calórica requerida y control semanal. Incremento de volumen aeróbico (baja intensidad post-entrenamiento).</div>`;
            if (player.impedance.musc < rules.muscle.yellow) html += `<div class="mb-2"><span class="font-bold text-orange-500">⚠ Fuerza:</span> Masa muscular por debajo de nivel óptimo (${player.impedance.musc}%). Ajustar ingesta proteica. Añadir 2 estímulos semanales de fuerza hipertrofia.</div>`;
            
            // Rendimiento
            if (player.yoyo.dif < 0) html += `<div class="mb-2"><span class="font-bold text-red-500">⚠ Resistencia:</span> Regresión en Yo-Yo Test (${player.yoyo.dif}). Protocolo intermitente de alta intensidad (15x15) suplementario.</div>`;
            
            // Biomecánica / Asimetría
            let asymVal = Math.abs(player.power.asym_cmj);
            if (asymVal > rules.asymmetry.yellow) {
                let weakLeg = player.power.asym_cmj > 0 ? "Izquierda" : "Derecha"; // + is right dominance in force, meaning left is weak
                html += `<div class="mb-2"><span class="font-bold text-red-500">⚠ Asimetría Crítica (${asymVal}%):</span> Riesgo de lesión alto. Déficit en pierna ${weakLeg}. <br><span class="text-slate-300">Prescripción:</span> Trabajo unilateral (sentadilla búlgara, peso muerto a 1 pierna). Foco excéntrico.</div>`;
            }

            // Kinésico textual mapping
            const kinStr = (player.kin.tobillos + player.kin.cadera + player.kin.unipodal).toLowerCase();
            if (kinStr.includes("reducida") || kinStr.includes("poca")) {
                html += `<div class="mb-2"><span class="font-bold text-orange-500">⚠ Movilidad:</span> Déficit articular detectado. <br><span class="text-slate-300">Prescripción:</span> Protocolo obligatorio WARM UP (Dorsiflexión con banda, obelisco, movilidad 90-90).</div>`;
            }
            if (player.kin.recomendaciones) {
                html += `<div class="mb-2"><span class="font-bold text-blue-400">ℹ Indicación Kinésica:</span> ${player.kin.recomendaciones}.</div>`;
            }

            if (html === '') html = '<div class="text-green-500 font-bold">✓ Parámetros dentro de rangos normales. Mantenimiento general.</div>';
            return html;
        }

        function renderIndividualView() {
            const playerId = parseInt(document.getElementById('player-select').value);
            const p = playersData.find(x => x.id === playerId);

            // Perfil
            document.getElementById('player-initials').innerText = p.name.split(',')[0].charAt(0) + p.name.split(',')[1].trim().charAt(0);
            document.getElementById('player-name').innerText = p.name;
            document.getElementById('player-position').innerText = `${p.position} | Dominancia: ${p.leg}`;
            
            // Composición
            document.getElementById('ind-peso').innerText = p.weight + ' kg';
            document.getElementById('ind-talla').innerText = p.height + ' m';
            
            document.getElementById('ind-adip').innerText = p.impedance.adip + ' %';
            document.getElementById('card-adip').className = `p-3 rounded-lg ${getTrafficColor(p.impedance.adip, 'adipose', true)}`;
            
            document.getElementById('ind-musc').innerText = p.impedance.musc + ' %';
            document.getElementById('card-musc').className = `p-3 rounded-lg ${getTrafficColor(p.impedance.musc, 'muscle', true)}`;

            // Radar Impedancia
            destroyChart('chart-radar-ind');
            const ctxRadar = document.getElementById('chart-radar-ind').getContext('2d');
            chartInstances['chart-radar-ind'] = new Chart(ctxRadar, {
                type: 'radar',
                data: {
                    labels: ['Masa Muscular', 'Adiposidad (Invertido)', 'Visceral (Invertido)'], // Invertidos visualmente para que grande = mejor
                    datasets: [{
                        label: p.name,
                        data: [p.impedance.musc, 30 - p.impedance.adip, 10 - p.impedance.visc], // Normalizacion simple visual
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: '#3b82f6',
                        pointBackgroundColor: '#3b82f6',
                        borderWidth: 2
                    }]
                },
                options: {
                    scales: { r: { angleLines: { color: '#334155' }, grid: { color: '#334155' }, pointLabels: { color: '#94a3b8' }, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });

            // YoYo
            destroyChart('chart-yoyo-ind');
            const ctxYoyoInd = document.getElementById('chart-yoyo-ind').getContext('2d');
            chartInstances['chart-yoyo-ind'] = new Chart(ctxYoyoInd, {
                type: 'bar',
                data: {
                    labels: ['2025', '2026'],
                    datasets: [{
                        label: 'Nivel Alcanzado',
                        data: [p.yoyo.y2025, p.yoyo.y2026],
                        backgroundColor: ['#475569', p.yoyo.dif >= 0 ? '#22c55e' : '#ef4444'],
                        borderRadius: 4
                    }]
                },
                options: { scales: { y: { min: 15, ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } }, plugins: { legend: { display: false } } }
            });

            const yInd = document.getElementById('yoyo-indicator');
            yInd.innerText = (p.yoyo.dif > 0 ? '+' : '') + p.yoyo.dif;
            yInd.className = `w-16 h-16 rounded-full flex items-center justify-center font-bold text-xl mb-6 text-white ${p.yoyo.dif > 0 ? 'bg-green-600' : (p.yoyo.dif < 0 ? 'bg-red-600' : 'bg-yellow-600')}`;

            // Potencia
            document.getElementById('ind-cmj').innerText = p.power.cmj;
            document.getElementById('ind-asym').innerText = p.power.asym_cmj + ' %';
            document.getElementById('card-asym').className = `p-3 rounded-lg ${getTrafficColor(p.power.asym_cmj, 'asymmetry', true)}`;

            destroyChart('chart-power-ind');
            const ctxPower = document.getElementById('chart-power-ind').getContext('2d');
            chartInstances['chart-power-ind'] = new Chart(ctxPower, {
                type: 'bar',
                data: {
                    labels: ['CMJ Der', 'CMJ Izq', 'Broad Der', 'Broad Izq'],
                    datasets: [{
                        label: 'Distancia/Altura',
                        data: [p.power.cmj_de, p.power.cmj_iz, p.power.broad_de*10, p.power.broad_iz*10], // Broad x10 para visualizacion en misma escala
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#3b82f6', '#8b5cf6'],
                    }]
                },
                options: { scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } }, plugins: { legend: { display: false } } }
            });

            // Kinésico & Alertas
            document.getElementById('kin-tobillos').innerText = p.kin.tobillos;
            document.getElementById('kin-cadera').innerText = p.kin.cadera;
            document.getElementById('kin-unipodal').innerText = p.kin.unipodal;
            
            document.getElementById('ind-alerts').innerHTML = generateActionPlan(p);
        }

        // --- COMPARE ---
        function renderCompareView() {
            const p1Id = parseInt(document.getElementById('compare-select-1').value);
            const p2Id = parseInt(document.getElementById('compare-select-2').value);
            const p1 = playersData.find(x => x.id === p1Id);
            const p2 = playersData.find(x => x.id === p2Id);

            document.getElementById('comp-name-1').innerText = p1.name;
            document.getElementById('comp-name-2').innerText = p2.name;

            // Radar
            destroyChart('chart-compare-radar');
            const ctxCompRadar = document.getElementById('chart-compare-radar').getContext('2d');
            chartInstances['chart-compare-radar'] = new Chart(ctxCompRadar, {
                type: 'radar',
                data: {
                    labels: ['Músculo', 'CMJ Bipodal', 'Yo-Yo 2026', 'Broad Jump'],
                    datasets: [
                        { label: p1.name, data: [p1.impedance.musc, p1.power.cmj, p1.yoyo.y2026*2, p1.power.broad*10], backgroundColor: 'rgba(59, 130, 246, 0.4)', borderColor: '#3b82f6' },
                        { label: p2.name, data: [p2.impedance.musc, p2.power.cmj, p2.yoyo.y2026*2, p2.power.broad*10], backgroundColor: 'rgba(239, 68, 68, 0.4)', borderColor: '#ef4444' }
                    ]
                },
                options: { scales: { r: { angleLines: { color: '#334155' }, grid: { color: '#334155' }, pointLabels: { color: '#94a3b8' }, ticks: { display: false } } }, plugins: { legend: { labels: { color: '#cbd5e1' } } } }
            });

            // Barras
            destroyChart('chart-compare-bar');
            const ctxCompBar = document.getElementById('chart-compare-bar').getContext('2d');
            chartInstances['chart-compare-bar'] = new Chart(ctxCompBar, {
                type: 'bar',
                data: {
                    labels: ['Asimetría CMJ (%)', 'Adiposidad (%)'],
                    datasets: [
                        { label: p1.name, data: [Math.abs(p1.power.asym_cmj), p1.impedance.adip], backgroundColor: '#3b82f6' },
                        { label: p2.name, data: [Math.abs(p2.power.asym_cmj), p2.impedance.adip], backgroundColor: '#ef4444' }
                    ]
                },
                options: { responsive: true, scales: { y: { ticks: { color: '#94a3b8' }, grid: { color: '#334155' } }, x: { ticks: { color: '#94a3b8' }, grid: { display: false } } }, plugins: { legend: { position: 'top', labels: { color: '#cbd5e1' } } } }
            });

            // Tabla
            const tb = document.getElementById('compare-table-body');
            const metrics = [
                { label: 'Peso (kg)', v1: p1.weight, v2: p2.weight },
                { label: 'Masa Muscular (%)', v1: p1.impedance.musc, v2: p2.impedance.musc },
                { label: 'Adiposidad (%)', v1: p1.impedance.adip, v2: p2.impedance.adip },
                { label: 'CMJ Bipodal (cm)', v1: p1.power.cmj, v2: p2.power.cmj },
                { label: 'Yo-Yo 2026', v1: p1.yoyo.y2026, v2: p2.yoyo.y2026 },
            ];

            tb.innerHTML = '';
            metrics.forEach(m => {
                const diff = (m.v1 - m.v2).toFixed(2);
                const diffHtml = diff > 0 ? `<span class="text-blue-400">+${diff}</span>` : (diff < 0 ? `<span class="text-red-400">${diff}</span>` : `<span class="text-slate-500">0</span>`);
                tb.innerHTML += `
                    <tr class="border-b border-slate-700 bg-slate-800">
                        <td class="px-6 py-4 font-medium text-white">${m.label}</td>
                        <td class="px-6 py-4">${m.v1}</td>
                        <td class="px-6 py-4">${m.v2}</td>
                        <td class="px-6 py-4 font-bold">${diffHtml}</td>
                    </tr>
                `;
            });
        }

        window.onload = init;
    </script>
</body>
</html>